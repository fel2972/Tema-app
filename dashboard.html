<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEMA</title>

    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>

<body>

<!-- Sidebar ‡πÅ‡∏ö‡∏ö Compact -->
 <button id="menuToggleBtn" class="menu-toggle-btn">
    <img src="images/menu.png" class="menu-toggle-icon">
</button>
<aside class="sidebar">
    <div class="sidebar-logo">T</div>

   <nav class="sidebar-menu">

    <a href="dashboard.html" class="menu-item active" title="Dashboard">
        <img src="images/home.png" class="menu-icon">
    </a>

    <a href="schedule.html" class="menu-item" title="‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
        <img src="images/agenda.png" class="menu-icon">
    </a>

    <a href="tasks.html" class="menu-item" title="‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á">
        <img src="images/notes.png" class="menu-icon">
    </a>

    <a href="settings.html" class="menu-item" title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤">
        <img src="images/settings.png" class="menu-icon">
    </a>

    </nav>


    <!-- ‡∏õ‡∏∏‡πà‡∏° Dark/Light PNG -->
    <button id="themeToggleBtn" class="theme-btn sidebar-theme-btn">
        <img id="themeIcon" src="images/sun.png">
    </button>
</aside>



<!-- ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ Dashboard -->
<main class="dashboard-main">
    <!-- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≤‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≠‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á) -->
    <div id="exampleBox" class="example-box">
    <h3 class="example-title">üåü ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>

    <div class="class-card" style="border-left: 8px solid #A7C7FF; background: #A7C7FF22;">
        <div class="class-card-title">‡∏Ñ‡∏ì‡∏¥‡∏ï‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</div>
        <div class="class-card-subinfo">08:30‚Äì09:20 | ‡∏´‡πâ‡∏≠‡∏á 302</div>
    </div>

    <div class="class-card" style="border-left: 8px solid #F7B5E8; background: #F7B5E822;">
        <div class="class-card-title">‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©</div>
        <div class="class-card-subinfo">10:00‚Äì10:50 | ‡∏´‡πâ‡∏≠‡∏á 209</div>
    </div>

    <p class="example-hint">‚ûï ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≤‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ ‚Äú‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‚Äù</p>
    </div>

    <h1 class="page-title">‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h1>

    <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≤‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ -->
    <div id="todayClasses"></div>

    <p class="empty-note" id="noClassMsg" style="display:none;">
        ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≤‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
    </p>
    <!-- ‚Ä¶ ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á + ‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ + todayClasses + noClassMsg) ... -->

    <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ -->
    <section class="task-summary-section">
        <div class="task-summary-header">
            <h2>‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
            <a href="tasks.html" class="task-summary-link">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Ä∫</a>
        </div>

        <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ 3 ‡∏Ñ‡πà‡∏≤ -->
        <div class="task-summary-cards">
            <div class="task-summary-card">
                <div class="task-summary-label">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
                <div class="task-summary-number" id="tasksTotalToday">0</div>
            </div>
            <div class="task-summary-card">
                <div class="task-summary-label">‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</div>
                <div class="task-summary-number" id="tasksDoneToday">0</div>
            </div>
            <div class="task-summary-card">
                <div class="task-summary-label">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</div>
                <div class="task-summary-number" id="tasksPendingToday">0</div>
            </div>
        </div>

        <!-- Progress bar -->
        <div class="task-progress">
            <div class="task-progress-bar">
                <div class="task-progress-fill" id="taskProgressFill"></div>
            </div>
            <div class="task-progress-text" id="taskProgressText">
                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
            </div>
        </div>

        <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏¥‡∏ä‡∏≤ -->
        <div class="task-filter-row" id="taskSubjectFilters">
            <!-- ‡∏à‡∏∞‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS -->
        </div>

        <!-- ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏ß‡∏¥‡∏ä‡∏≤ -->
        <div id="taskGroupsContainer"></div>

        <!-- ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á -->
        <p class="empty-note" id="noTasksTodayMsg" style="display:none;">
            ‚úÖ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß
        </p>
    </section>


</main>

<script src="js/auth.js"></script>
<script src="js/theme.js"></script>
<script src="js/scheduleUtils.js"></script>
<script src="js/tasksUtils.js"></script>

<script>
/* ============================
   ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ"
============================ */
function loadTodaySchedule() {

    const all = loadSchedule();  // ‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å localStorage
    const box = document.getElementById("todayClasses");
    const noClass = document.getElementById("noClassMsg");
    const exampleBox = document.getElementById("exampleBox");

    box.innerHTML = ""; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Å‡πà‡∏≠‡∏ô

    // ‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
    const days = ["‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå","‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£","‡∏û‡∏∏‡∏ò","‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ","‡∏®‡∏∏‡∏Å‡∏£‡πå","‡πÄ‡∏™‡∏≤‡∏£‡πå"];
    const today = days[new Date().getDay()];

    // ‡∏´‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏≤‡∏ö‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
    const todayClasses = all.filter(c => c.day === today);

    // ‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≤‡∏ö‡∏à‡∏£‡∏¥‡∏á ‚Üí ‡πÅ‡∏™‡∏î‡∏á exampleBox
    if (todayClasses.length === 0) {
        exampleBox.style.display = "block";
        noClass.style.display = "none";
        return;
    }

    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≤‡∏ö‡∏à‡∏£‡∏¥‡∏á ‚Üí ‡∏ã‡πà‡∏≠‡∏ô exampleBox
    exampleBox.style.display = "none";
    noClass.style.display = "none";

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤
    todayClasses.sort((a, b) => a.timeStart.localeCompare(b.timeStart));

    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≤‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏£‡∏¥‡∏á
    todayClasses.forEach(cls => {

        // ‡∏≠‡πà‡∏≤‡∏ô‡∏™‡∏µ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤
        const colors = JSON.parse(localStorage.getItem("subjectColors") || "{}");
        const color = colors[cls.subject] || "#A7C7FF"; // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ä‡πâ‡∏ü‡πâ‡∏≤‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•

        const card = document.createElement("div");
        card.className = "class-card";
        card.style.borderLeft = `8px solid ${color}`;
        card.style.background = color + "22"; // ‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•‡∏à‡∏≤‡∏á ‡πÜ

        card.innerHTML = `
            <div class="class-card-title">${cls.subject}</div>
            <div class="class-card-subinfo">
                ${cls.timeStart}‚Äì${cls.timeEnd}  
                ${cls.room ? " | ‡∏´‡πâ‡∏≠‡∏á " + cls.room : ""}
            </div>
        `;

        box.appendChild(card);
    });
}


/* ============================
   ‡∏™‡∏£‡∏∏‡∏õ "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ"
============================ */

let currentTaskFilter = "ALL";  // ALL ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤
let tasksTodayCache = [];       // ‡πÄ‡∏Å‡πá‡∏ö‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏ã‡πâ‡∏≥

function loadTasksSummary() {
    const allTasks = loadTasks();       // ‡∏à‡∏≤‡∏Å tasksUtils.js
    const todayStr = getTodayISO();     // "YYYY-MM-DD"

    // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
    const tasksToday = allTasks.filter(t => !t.date || t.date === todayStr);
    tasksTodayCache = tasksToday;

    const totalToday   = tasksToday.length;
    const doneToday    = tasksToday.filter(t => t.done).length;
    const pendingToday = totalToday - doneToday;

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ
    document.getElementById("tasksTotalToday").textContent   = totalToday;
    document.getElementById("tasksDoneToday").textContent    = doneToday;
    document.getElementById("tasksPendingToday").textContent = pendingToday;

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Progress bar
    const fill = document.getElementById("taskProgressFill");
    const text = document.getElementById("taskProgressText");

    if (totalToday === 0) {
        fill.style.width = "0%";
        text.textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ";
    } else {
        const percent = Math.round((doneToday / totalToday) * 100);
        fill.style.width = percent + "%";

        if (percent === 0) {
            text.textContent = "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏¢ ‡∏•‡∏≠‡∏á‡∏ó‡∏≥‡∏™‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏î‡∏π‡∏ô‡∏∞ ‚úä";
        } else if (percent < 100) {
            text.textContent = `‡∏ó‡∏≥‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ${percent}% ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!`;
        } else {
            text.textContent = "‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß üéâ";
        }
    }

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï filter ‡∏ß‡∏¥‡∏ä‡∏≤ + ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á
    buildTaskSubjectFilters(tasksToday);
    renderTaskGroups();
}

/* ----------------------------
   ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° filter ‡∏ï‡∏≤‡∏°‡∏ß‡∏¥‡∏ä‡∏≤
---------------------------- */
function buildTaskSubjectFilters(tasksToday) {
    const container = document.getElementById("taskSubjectFilters");
    container.innerHTML = "";

    if (!tasksToday || tasksToday.length === 0) {
        container.style.display = "none";
        return;
    }
    container.style.display = "flex";

    // set ‡∏ß‡∏¥‡∏ä‡∏≤
    const subjectsSet = new Set();
    tasksToday.forEach(t => {
        if (t.subject && t.subject.trim()) {
            subjectsSet.add(t.subject.trim());
        }
    });

    // ‡∏õ‡∏∏‡πà‡∏° "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"
    const allChip = createSubjectChip("‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", "ALL");
    container.appendChild(allChip);

    // ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏°‡∏ß‡∏¥‡∏ä‡∏≤
    Array.from(subjectsSet).sort().forEach(subj => {
        const chip = createSubjectChip(subj, subj);
        container.appendChild(chip);
    });

    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    setActiveSubjectChip(currentTaskFilter);
}

function createSubjectChip(label, value) {
    const chip = document.createElement("button");
    chip.className = "task-filter-chip";
    chip.textContent = label;
    chip.dataset.value = value;

    chip.addEventListener("click", () => {
        currentTaskFilter = value;
        setActiveSubjectChip(value);
        renderTaskGroups();
    });

    return chip;
}

function setActiveSubjectChip(value) {
    const chips = document.querySelectorAll(".task-filter-chip");
    chips.forEach(ch => {
        if (ch.dataset.value === value) ch.classList.add("active");
        else ch.classList.remove("active");
    });
}

/* ----------------------------
   ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏ß‡∏¥‡∏ä‡∏≤
---------------------------- */
function renderTaskGroups() {
    const container = document.getElementById("taskGroupsContainer");
    const noTasksMsg = document.getElementById("noTasksTodayMsg");

    container.innerHTML = "";

    if (!tasksTodayCache || tasksTodayCache.length === 0) {
        noTasksMsg.style.display = "block";
        return;
    }

    // ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
    let pending = tasksTodayCache.filter(t => !t.done);

    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ filter ‡∏ß‡∏¥‡∏ä‡∏≤
    if (currentTaskFilter !== "ALL") {
        pending = pending.filter(t => (t.subject || "").trim() === currentTaskFilter);
    }

    if (pending.length === 0) {
        noTasksMsg.style.display = "block";
        return;
    } else {
        noTasksMsg.style.display = "none";
    }

    // ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏°‡∏ß‡∏¥‡∏ä‡∏≤
    const groups = {};
    pending.forEach(t => {
        const key = t.subject && t.subject.trim()
            ? t.subject.trim()
            : "‡∏≠‡∏∑‡πà‡∏ô ‡πÜ / ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏¥‡∏ä‡∏≤";
        if (!groups[key]) groups[key] = [];
        groups[key].push(t);
    });

    const today = new Date();
    const nowTime = today.toTimeString().slice(0,5); // "HH:MM"

    Object.keys(groups).sort().forEach(subject => {
        const tasks = groups[subject];

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤
        tasks.sort((a,b) => {
            const at = a.time || "";
            const bt = b.time || "";
            return at.localeCompare(bt);
        });

        // ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ß‡∏¥‡∏ä‡∏≤
        const groupBox = document.createElement("div");
        groupBox.className = "task-group-box";

        const header = document.createElement("div");
        header.className = "task-group-header";
        header.innerHTML = `
            <div class="task-group-title">${subject}</div>
            <div class="task-group-count">${tasks.length} ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á</div>
        `;

        const list = document.createElement("div");
        list.className = "task-group-list";

        tasks.forEach(task => {
            // ‡∏ï‡∏£‡∏ß‡∏à flag ‡πÄ‡∏•‡∏¢‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ time)
            let statusTag = "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ";
            let statusClass = "tag-today";

            if (task.time) {
                const dueTime = task.time;
                if (dueTime < nowTime) {
                    statusTag = "‡πÄ‡∏•‡∏¢‡∏Å‡∏≥‡∏´‡∏ô‡∏î";
                    statusClass = "tag-overdue";
                }
            }

            const item = document.createElement("div");
            item.className = "task-group-item";
            item.innerHTML = `
                <div class="task-item-left">
                    <div class="task-checkbox-fake"></div>
                </div>
                <div class="task-item-main">
                    <div class="task-item-title">${task.title}</div>
                    <div class="task-item-meta">
                        ‡∏™‡πà‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ${task.time ? " ‡πÄ‡∏ß‡∏•‡∏≤ " + task.time : ""} 
                        ${task.note ? " ‚Ä¢ " + task.note : ""}
                    </div>
                </div>
                <div class="task-item-right">
                    <span class="task-status-tag ${statusClass}">${statusTag}</span>
                </div>
            `;
            list.appendChild(item);
        });

        groupBox.appendChild(header);
        groupBox.appendChild(list);
        container.appendChild(groupBox);
    });
}

/* ----------------------------
   Helper: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ "YYYY-MM-DD"
---------------------------- */
function getTodayISO() {
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth() + 1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
}

/* ============================
   ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à
============================ */
document.addEventListener("DOMContentLoaded", () => {
    loadTodaySchedule();
    loadTasksSummary();
});
</script>

</body>
</html>